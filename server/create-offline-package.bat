@echo off
chcp 65001 >nul
cls

REM ============================================
REM   ุขูุงุฏูโุณุงุฒ ุจุณุชู ุขููุงู
REM   ุงู ูุงู ุจุฑุง ุงุฌุงุฏ wheelhouse ุงุณุชูุงุฏู ูโุดูุฏ
REM ============================================

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ   ๐ฆ ุขูุงุฏูโุณุงุฒ ุจุณุชู ูุตุจ ุขููุงู Termo Server             โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ุงู ุงุจุฒุงุฑ ุชูุงู ูุงุจุณุชฺฏโูุง ููุฑุฏ ูุงุฒ ุฑุง ุฏุงูููุฏ ูโฺฉูุฏ
echo ุชุง ุจุชูุงูุฏ ุจุฏูู ุงูุชุฑูุช ุณุฑูุฑ ุฑุง ูุตุจ ฺฉูุฏ.
echo.
echo โ๏ธ  ูุงุฒ ุจู ุงุชุตุงู ุงูุชุฑูุช ุฏุงุฑุฏ!
echo.

cd /d "%~dp0"

REM ุจุฑุฑุณ Python
echo [1/3] ุจุฑุฑุณ Python...
python --version >nul 2>&1
if errorlevel 1 (
    echo โ Python ุงูุช ูุดุฏ!
    pause
    exit /b 1
)
echo โ Python ุงูุช ุดุฏ
echo.

REM ุงุฌุงุฏ ูพูุดู wheelhouse
echo [2/3] ุงุฌุงุฏ ูพูุดู wheelhouse...
if exist "wheelhouse" (
    echo โ๏ธ  ูพูุดู wheelhouse ุงุฒ ูุจู ููุฌูุฏ ุงุณุช
    set /p OVERWRITE="ุขุง ูโุฎูุงูุฏ ูุญุชูุงุช ุฑุง ูพุงฺฉ ฺฉูุฏุ (Y/N): "
    if /i "!OVERWRITE!"=="Y" (
        echo ูพุงฺฉ ฺฉุฑุฏู ูุญุชูุงุช ูุฏู...
        rd /s /q wheelhouse
        mkdir wheelhouse
    )
) else (
    mkdir wheelhouse
)
echo โ ูพูุดู wheelhouse ุขูุงุฏู ุงุณุช
echo.

REM ุฏุงูููุฏ ูุงุจุณุชฺฏโูุง
echo [3/3] ุฏุงูููุฏ ูุงุจุณุชฺฏโูุง...
echo โณ ุงู ูุฑุงูุฏ ููฺฉู ุงุณุช ฺูุฏ ุฏููู ุทูู ุจฺฉุดุฏ...
echo.

python -m pip download -r requirements.txt -d wheelhouse

if errorlevel 1 (
    echo.
    echo โ ุฎุทุง ุฏุฑ ุฏุงูููุฏ ูุงุจุณุชฺฏโูุง!
    echo.
    echo ๐ก ุฑุงูโุญูโูุง ูพุดููุงุฏ:
    echo    1. ุงุชุตุงู ุงูุชุฑูุช ุฑุง ุจุฑุฑุณ ฺฉูุฏ
    echo    2. pip ุฑุง ุจูโุฑูุฒ ฺฉูุฏ: python -m pip install --upgrade pip
    echo    3. ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ
    echo.
    pause
    exit /b 1
)

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ  โ ุจุณุชู ุขููุงู ุจุง ููููุช ุขูุงุฏู ุดุฏ!                       โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ ุงุทูุงุนุงุช:

REM ุดูุงุฑุด ูุงูโูุง
set COUNT=0
for %%F in (wheelhouse\*.*) do set /a COUNT+=1
echo    ุชุนุฏุงุฏ ูุงูโูุง: %COUNT%

REM ูุญุงุณุจู ุญุฌู
for /f "tokens=3" %%a in ('dir /s wheelhouse ^| find "bytes"') do set SIZE=%%a
if defined SIZE (
    set /a SIZE_MB=!SIZE:~0,-3! / 1024
    echo    ุญุฌู ฺฉู: !SIZE_MB! MB ุชูุฑุจุงู
)

echo.
echo ๐ฆ ุจุณุชู ุขููุงู ุฏุฑ ูพูุดู "wheelhouse" ุฐุฎุฑู ุดุฏ
echo.
echo ๐ ูุฑุงุญู ุจุนุฏ:
echo    1. ฺฉู ูพูุดู server ุฑุง ููุฑุงู ุจุง wheelhouse ฺฉูพ ฺฉูุฏ
echo    2. ุฑู ุณุณุชู ูุฏู (ุจุฏูู ุงูุชุฑูุช):
echo       - ูุงู setup-offline.bat ุฑุง ุงุฌุฑุง ฺฉูุฏ
echo       - ุง ุฏุณุช: pip install --no-index --find-links=wheelhouse -r requirements.txt
echo.

pause
